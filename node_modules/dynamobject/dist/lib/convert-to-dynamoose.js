"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const Dynamoose = require("dynamoose");
const toDynamobject = (path, object, config = {}) => {
    Dynamoose.AWS.config.update({
        region: config.region
    });
    const clone = Object.assign({}, object);
    const model = Dynamoose.model(path, getModel(object, config && config.hashKey));
    clone.model = model;
    clone.upload = () => { new clone.model(clone).save(); }; // new clone.model(this).save() };
    clone.get = (key) => clone.get(key).then((res) => res && clone.constructor && clone.constructor(res));
    return clone;
};
exports.toDynamobject = toDynamobject;
function getModel(oldObj, key = "_id") {
    const object = Object.assign({}, oldObj);
    for (const property in object) {
        if (object.hasOwnProperty(property)) {
            const className = object[property].constructor.name;
            object[property] = { type: eval(className) };
            if (property == key)
                object[property].hashKey = true;
        }
    }
    return object;
}
exports.default = toDynamobject;
